<!DOCTYPE html>
<html lang="en">
<head>
    <title>image and info</title>
    <link rel="stylesheet" href="/stylesheets/style.css">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
</head>

<body style="background-color: darkblue;">
    <div id="app">
        <!-- align to right to confuse people -->
        <h1 tabindex="1" style="text-align: right;">image and info</h1>
        <p tabindex="2" style="text-align: right;">name: max</p>
        <p tabindex="3" style="text-align: right;">size: medium</p>
        <p tabindex="4" style="text-align: right;">owner username: alice123</p>
        <br />
        <!-- no alt text -->
        <img tabindex="5" v-if="imageSrc" :src="imageSrc.message" />
        <button tabindex="6" style="width: 30px; height: 20px;" type="button" @click.once="fetchDog">load image</button>
    </div>

    <script>
        const { createApp } = Vue;
        createApp({
        data() {
            return {
                imageSrc: null
            };
        },
        methods: {
            async fetchDog() {
                const response = await fetch ('https://dog.ceo/api/breeds/image/random');
                this.imageSrc = await response.json();
            }
        }
        }).mount('#app');
    </script>
    <script>
    const { createApp, ref, onMounted } = Vue;

    createApp({
      setup() {
        var dogs = ref([]);
        var dogImgs = ref({ message: [] });
        var message = ref('Welcome to the Dog Walking Service!');
        var username = ref('');
        var password = ref('');

        async function getDogs() {
          const response = await fetch('/api/dogs'); // get dogs route to get dog data
          dogs.value = await response.json(); // set the v-model dogs var to the dog data from internal api call
          // console.log(this.dogs.length);
          const numDogs = dogs.value.length; // get the number of dogs in the database so we can get the right no. of pics
          var dogsString = 'https://dog.ceo/api/breeds/image/random/' + numDogs; // concat num so we get right no. in url
          const dogCeoImages = await fetch(dogsString); // fetch x number of random pics from dog.ceo
          dogImgs.value = await dogCeoImages.json(); // set the received images to the v-model dogs variable to use in html
          // console.log(this.dogImgs.message[0]);
        }

        async function loginSubmit() {
          const response = await fetch('/api/users/login', { // get the login route
            method: 'POST', // post request because it is not repeatable, cant login while logged in
            credentials: 'include',
            headers: { 'Content-Type': 'application/json' }, // the route can expect json
            body: JSON.stringify({ // send v-model username and password to route as json
              username: username.value, // sends the username in the data() above
              password: password.value }) // sends the password in the data() above
            });

            const result = await response.json(); // waits for route to return something to this function
            if (result.redirect) { // if the result came back with something for .redirect
              window.location.href = result.redirect; // go to redirect location (owner/walker-dashboard.html)
            }
        }

        onMounted(() => {
          getDogs(); // run when app loads
        });

        return {
          dogs,
          dogImgs,
          message,
          username,
          password,
          getDogs,
          loginSubmit
        };
      }
    }).mount('#app');
  </script>

</body>
</html>